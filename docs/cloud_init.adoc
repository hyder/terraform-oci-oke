= cloud-init
:idprefix:
:idseparator: -
:sectlinks:
:toc: auto

:uri-cloudinit: https://docs.oracle.com/en-us/iaas/Content/ContEng/Tasks/contengusingcustomcloudinitscripts.htm
:uri-source-cloudinit-doc: https://github.com/oracle-terraform-modules/terraform-oci-oke/blob/main/docs/instructions.adoc#configuring-cloud-init-for-the-nodepools
:uri-repo: https://github.com/oracle-terraform-modules/terraform-oci-oke
:uri-worker-script: link:{uri-repo}/modules/oke/cloudinit/worker.template.sh

== Configuring cloud-init
Custom actions may be configured on instance startup in an number of ways depending on the use-case and preference.

.See also:
* https://registry.terraform.io/providers/hashicorp/template/latest/docs/data-sources/cloudinit_config.html[`template_cloudinit_config`]
* https://cloudinit.readthedocs.io/en/latest/explanation/format.html#mime-multi-part-archive[User data formats]
* https://cloudinit.readthedocs.io/en/latest/reference/modules.html[Module reference]

.The configured timezone is applied using the cloud init module:
[cols="a,a,a,a,a",options="header,autowidth"]
|===
|Name |Description |Type |Default |Required

|[[input_timezone]] <<input_timezone,timezone>>
|The preferred timezone for workers, operator, and bastion instances.
|`string`
|`"Etc/UTC"`
|no

|===

=== Operator

.Cloud init configuration applied to the operator host:
[source]
----
operator_cloud_init = [
  {
    content      = <<-EOT
    runcmd:
    - echo "Operator cloud_init using cloud-config"
    EOT
    content_type = "text/cloud-config",
  },
  {
    content      = "/path/to/file"
    content_type = "text/cloud-boothook",
  },
  {
    content      = "<Base64-encoded content>"
    content_type = "text/x-shellscript",
  },
]
----

=== Workers (global)

.Cloud init configuration applied to all workers:
[source]
----
worker_cloud_init = [
  {
    content      = <<-EOT
    runcmd:
    - echo "Global cloud_init using cloud-config"
    EOT
    content_type = "text/cloud-config",
  },
  {
    content      = "/path/to/file"
    content_type = "text/cloud-boothook",
  },
  {
    content      = "<Base64-encoded content>"
    content_type = "text/x-shellscript",
  },
]
----



=== Workers (pool-specific)

.Cloud init configuration applied to a specific worker pool:
[source]
----
worker_pools = {
  pool_default = {}
  pool_custom = {
    cloud_init = [
      {
        content      = <<-EOT
        runcmd:
        - echo "Pool-specific cloud_init using cloud-config"
        EOT
        content_type = "text/cloud-config",
      },
      {
        content      = "/path/to/file"
        content_type = "text/cloud-boothook",
      },
      {
        content      = "<Base64-encoded content>"
        content_type = "text/x-shellscript",
      },
    ]
  }
}
----